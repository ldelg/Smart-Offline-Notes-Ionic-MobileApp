<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>Settings</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="settings-content">
  <div class="content-wrapper">
    <ion-card class="glass-card">
      <ion-card-header>
        <ion-card-subtitle>Model</ion-card-subtitle>
        <ion-card-title>Transcription Engine</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-item lines="full">
          <ion-label position="stacked">Select the model to use</ion-label>
          <ion-select
            [value]="model()"
            interface="popover"
            (ionChange)="onModelChange($event.detail.value)"
          >
            @for (option of modelOptions; track option.value) {
            <ion-select-option [value]="option.value">
              {{ option.label }}
            </ion-select-option>
            }
          </ion-select>
        </ion-item>

        <div class="toggles-row">
          <div class="toggle-item">
            <ion-label>Multilingual</ion-label>
            <ion-toggle
              [checked]="multilingual()"
              (ionChange)="onMultilingualChange($event.detail.checked)"
            ></ion-toggle>
          </div>

          <div class="toggle-item">
            <ion-label>Quantized</ion-label>
            <ion-toggle
              [checked]="quantized()"
              (ionChange)="onQuantizedChange($event.detail.checked)"
            ></ion-toggle>
          </div>
        </div>

        <div class="model-info">
          <ion-item lines="none">
            <ion-label>
              <h3>Active Model</h3>
              @if (lastUsedModel()) {
              <p class="model-name">
                {{ lastUsedModel() }}
                @if (quantized()) {
                <span class="quantized-label">(quantized)</span>
                }
              </p>
              <p class="model-hint">Last used during transcription</p>
              } @else {
              <p class="model-name">
                {{ model() }}{{ multilingual() ? '' : '.en' }}
                @if (quantized()) {
                <span class="quantized-label">(quantized)</span>
                }
              </p>
              <p class="model-hint">Will be used on next transcription</p>
              }
            </ion-label>
          </ion-item>
        </div>
      </ion-card-content>
    </ion-card>

    @if (multilingual()) {
    <ion-card class="glass-card">
      <ion-card-header>
        <ion-card-subtitle>Language & Task</ion-card-subtitle>
        <ion-card-title>Transcription Mode</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-item lines="full">
          <ion-label position="stacked">Select the source language</ion-label>
          <ion-select
            [value]="language()"
            interface="popover"
            (ionChange)="onLanguageChange($event.detail.value)"
          >
            @for (lang of languages; track lang.id) {
            <ion-select-option [value]="lang.id">
              {{ lang.label }}
            </ion-select-option>
            }
          </ion-select>
        </ion-item>

        <ion-item lines="full">
          <ion-label position="stacked">Select the task to perform</ion-label>
          <ion-select
            [value]="task()"
            interface="popover"
            (ionChange)="onTaskChange($event.detail.value)"
          >
            <ion-select-option value="transcribe">
              Transcribe
            </ion-select-option>
            <ion-select-option value="translate">
              Translate to English
            </ion-select-option>
          </ion-select>
        </ion-item>
      </ion-card-content>
    </ion-card>
    }

    <ion-card class="glass-card">
      <ion-card-header>
        <ion-card-subtitle>Data Management</ion-card-subtitle>
        <ion-card-title>Export & Import Notes</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <p class="data-description">
          Export your notes as a JSON file for backup, or import notes from a
          previous export.
        </p>

        <div class="data-actions">
          <ion-button
            expand="block"
            fill="outline"
            class="data-button"
            (click)="exportNotes()"
          >
            <ion-icon slot="start" name="download-outline"></ion-icon>
            Export Notes
          </ion-button>

          <ion-button
            expand="block"
            fill="outline"
            class="data-button"
            (click)="triggerImport()"
          >
            <ion-icon slot="start" name="cloud-upload-outline"></ion-icon>
            Import Notes
          </ion-button>
        </div>

        <input
          type="file"
          accept=".json"
          #fileInput
          (change)="handleFileImport($event)"
          style="display: none"
        />
      </ion-card-content>
    </ion-card>

    <ion-card class="glass-card">
      <ion-card-header>
        <ion-card-subtitle>Support</ion-card-subtitle>
        <ion-card-title>Support Development</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <p class="donation-description">
          If you find this app useful, consider making a donation to support
          continued development and improvements.
        </p>

        <ion-button
          expand="block"
          class="donation-button"
          (click)="openDonationLink()"
        >
          <ion-icon slot="start" name="heart-outline"></ion-icon>
          Donate
        </ion-button>
      </ion-card-content>
    </ion-card>
  </div>
</ion-content>
