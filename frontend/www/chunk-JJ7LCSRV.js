import{a as O,b as ge,c as me,d as he,f as fe}from"./chunk-KHNVQIKD.js";import{a as z,b as V}from"./chunk-WNQ4N7RJ.js";import"./chunk-VUKOYLCU.js";import"./chunk-QUJFQN2Y.js";import"./chunk-CFHZKLO3.js";import"./chunk-XX63LXAP.js";import"./chunk-E6R74AAZ.js";import"./chunk-7FY2OE2O.js";import"./chunk-3AKH2QW5.js";import"./chunk-MO3Y5KPV.js";import"./chunk-UHNYFROW.js";import"./chunk-IDC5F2JZ.js";import{a as re,d as le,f as se,h as ce,j as de,n as pe}from"./chunk-IRPPD5UH.js";import{a as ue,b as v}from"./chunk-KI3OGBFQ.js";import"./chunk-CFOVYPQF.js";import"./chunk-Z3TYMMPC.js";import"./chunk-MTHZ7MWU.js";import"./chunk-WI5MSH4N.js";import"./chunk-ZL4KYEC3.js";import"./chunk-CKP3SGE2.js";import"./chunk-5QDBXRKG.js";import{$ as F,A as g,Bb as oe,Db as ae,E as L,J as y,K as M,L as I,M as N,N as x,Na as R,O as o,P as a,Q as E,U as P,V as w,W as _,_ as $,aa as B,ca as r,cb as j,da as k,db as W,ea as D,eb as Y,fb as q,gb as K,hb as Q,ib as H,ja as C,jb as J,ka as U,kb as G,lb as Z,n as b,ob as X,p as h,q as f,tb as ee,ub as te,w as T,xb as ne,yb as ie}from"./chunk-P77PPINA.js";import"./chunk-447CKG3T.js";import"./chunk-CDZFCBFW.js";import"./chunk-E2CLONXR.js";import"./chunk-KRDHHS7Z.js";import"./chunk-JVTPOORY.js";import"./chunk-CLDSZD2A.js";import"./chunk-4WFVMWDK.js";import"./chunk-M2X7KQLB.js";import"./chunk-DVVH2KKN.js";import"./chunk-NV3QH4JK.js";import"./chunk-LRFGNCHE.js";import"./chunk-OZYWYLNK.js";import"./chunk-42C7ZIID.js";import{e as m}from"./chunk-JHI3MBHO.js";var we=v("Browser",{web:()=>import("./chunk-SYGJF4EM.js").then(i=>new i.BrowserWeb)});function _e(i){i.CapacitorUtils.Synapse=new Proxy({},{get(s,l){return new Proxy({},{get(e,t){return(n,c,p)=>{let d=i.Capacitor.Plugins[l];if(d===void 0){p(new Error(`Capacitor plugin ${l} not found`));return}if(typeof d[t]!="function"){p(new Error(`Method ${t} not found in Capacitor plugin ${l}`));return}m(null,null,function*(){try{let u=yield d[t](n);c(u)}catch(u){p(u)}})}}})}})}function Se(i){i.CapacitorUtils.Synapse=new Proxy({},{get(s,l){return i.cordova.plugins[l]}})}function Ce(i=!1){typeof window>"u"||(window.CapacitorUtils=window.CapacitorUtils||{},window.Capacitor!==void 0&&!i?_e(window):window.cordova!==void 0&&Se(window))}var A=v("Filesystem",{web:()=>import("./chunk-XK4B35U2.js").then(i=>new i.FilesystemWeb)});Ce();var xe=v("Share",{web:()=>import("./chunk-23DJIKKN.js").then(i=>new i.ShareWeb)});var be=["fileInput"],ye=(i,s)=>s.value,Me=(i,s)=>s.id;function ve(i,s){if(i&1&&(o(0,"ion-select-option",8),r(1),a()),i&2){let l=s.$implicit;x("value",l.value),g(),D(" ",l.label," ")}}function Ee(i,s){if(i&1){let l=P();o(0,"div",9)(1,"div",25)(2,"ion-label"),r(3,"Multilingual"),a(),o(4,"ion-toggle",26),w("ionChange",function(t){h(l);let n=_();return f(n.onMultilingualChange(t.detail.checked))}),a()()()}if(i&2){let l=_();g(4),x("checked",l.multilingual())("disabled",!l.networkService.isOnline())}}function Pe(i,s){if(i&1&&(o(0,"p",27),r(1),a(),o(2,"p",28),r(3,"Last used during transcription"),a()),i&2){let l=_();g(),k(l.lastUsedModelLabel())}}function ke(i,s){if(i&1&&(o(0,"p",27),r(1),a(),o(2,"p",28),r(3,"Will be used on next transcription"),a()),i&2){let l=_();g(),k(l.currentModelLabel())}}function Oe(i,s){if(i&1&&(o(0,"ion-select-option",8),r(1),a()),i&2){let l=s.$implicit;x("value",l.id),g(),D(" ",l.label," ")}}function Te(i,s){if(i&1){let l=P();o(0,"ion-card",4)(1,"ion-card-header")(2,"ion-card-subtitle"),r(3,"Language & Task"),a(),o(4,"ion-card-title"),r(5,"Transcription Mode"),a()(),o(6,"ion-card-content")(7,"ion-item",5)(8,"ion-label",6),r(9,"Select the source language"),a(),o(10,"ion-select",29),w("ionChange",function(t){h(l);let n=_();return f(n.onLanguageChange(t.detail.value))}),I(11,Oe,2,2,"ion-select-option",8,Me),a()(),o(13,"ion-item",5)(14,"ion-label",6),r(15,"Select the task to perform"),a(),o(16,"ion-select",29),w("ionChange",function(t){h(l);let n=_();return f(n.onTaskChange(t.detail.value))}),o(17,"ion-select-option",30),r(18," Transcribe "),a(),o(19,"ion-select-option",31),r(20," Translate to English "),a()()()()()}if(i&2){let l=_();g(10),x("value",l.language()),g(),N(l.languages),g(5),x("value",l.task())}}function Ie(i,s){i&1&&(o(0,"span",12),r(1,"\u{1F7E2} Online"),a())}function Ne(i,s){i&1&&(o(0,"span",13),r(1,"\u{1F534} Offline"),a())}function De(i,s){i&1&&(o(0,"span"),r(1,"Calculating..."),a())}function Ue(i,s){if(i&1&&(o(0,"span"),r(1),a()),i&2){let l=_();g(),k(l.cacheSize())}}var ct=(()=>{let s=class s{constructor(){this.settings=b(me),this.notesStore=b(fe),this.alertController=b(ne),this.platform=b(R),this.networkService=b(he),this.STRIPE_PAYMENT_LINK_URL="https://donate.stripe.com/4gweYZ26zbfY25y9AA",this.cacheSize=T("0 MB"),this.isCalculatingCache=T(!1),this.model=C(()=>this.settings.model()),this.multilingual=C(()=>this.settings.multilingual()),this.quantized=C(()=>this.settings.quantized()),this.language=C(()=>this.settings.language()),this.task=C(()=>this.settings.task()),this.lastUsedModel=C(()=>this.settings.lastUsedModel()),this.modelOptions=O,this.languages=ge,this.lastUsedModelLabel=C(()=>{let e=this.lastUsedModel();if(!e)return"";let t=O.find(n=>n.value===e);return t?t.label:e}),this.currentModelLabel=C(()=>{let e=this.model();if(!e)return"";let t=O.find(n=>n.value===e);return t?t.label:e}),this.isMultilingualModel=C(()=>this.isModelMultilingual(this.model())),re({heartOutline:ce,downloadOutline:se,cloudUploadOutline:le,trashOutline:pe,refreshOutline:de}),this.calculateCacheSize(),U(()=>{this.settings.lastUsedModel()&&setTimeout(()=>this.calculateCacheSize(),2e3)}),U(()=>{let e=this.networkService.isOnline(),t=this.settings.lastUsedModel(),n=this.settings.model();!e&&t&&n!==t&&this.settings.setModel(t)})}ionViewWillEnter(){this.calculateCacheSize()}isModelMultilingual(e){return!e.endsWith(".en")&&!e.startsWith("distil-whisper/")}onModelChange(e){let t=this.settings.model();e!==t&&(this.settings.setModel(e),this.isModelMultilingual(e)||this.settings.setMultilingual(!1))}onMultilingualChange(e){this.settings.setMultilingual(e)}onLanguageChange(e){this.settings.setLanguage(e)}onTaskChange(e){(e==="translate"||e==="transcribe")&&this.settings.setTask(e)}openDonationLink(){return m(this,null,function*(){try{yield this.openStripeUrl(this.STRIPE_PAYMENT_LINK_URL)}catch(e){console.error("Error opening donation link:",e),yield this.showDonationError()}})}openStripeUrl(e){return m(this,null,function*(){this.platform.is("capacitor")?yield we.open({url:e,windowName:"_system"}):window.open(e,"_blank")})}showDonationError(){return m(this,null,function*(){yield(yield this.alertController.create({header:"Donation Error",message:"There was an error processing your donation. Please try again later.",buttons:["OK"]})).present()})}exportNotes(){return m(this,null,function*(){try{let e=this.notesStore.exportNotes(),t=this.notesStore.notes(),n=`smartnotes-backup-${t.length}-notes-${new Date().toISOString().split("T")[0]}.json`;if(ue.isNativePlatform())try{let u=yield A.writeFile({path:`Download/${n}`,data:e,directory:z.ExternalStorage,encoding:V.UTF8});yield this.showSuccessAlert("Export Successful",`File saved to Downloads folder: ${n}`);return}catch(u){console.error("Direct save failed, trying Share:",u);try{let S=yield A.writeFile({path:n,data:e,directory:z.Cache,encoding:V.UTF8});yield xe.share({title:"SmartNotes Backup",text:`Backup of ${t.length} note${t.length!==1?"s":""}`,url:S.uri,dialogTitle:"Save SmartNotes Backup"}),yield this.showSuccessAlert("Export Successful","Choose where to save the file from the share dialog.");return}catch(S){if(S.message?.includes("cancel")||S.message?.includes("User"))return;throw S}}let c=new Blob([e],{type:"application/json"}),p=URL.createObjectURL(c),d=document.createElement("a");d.href=p,d.download=n,d.style.display="none",document.body.appendChild(d),d.click(),setTimeout(()=>{document.body.removeChild(d),URL.revokeObjectURL(p)},100),yield this.showSuccessAlert("Export Successful",`File downloaded as ${n}. Check your Downloads folder.`)}catch(e){console.error("Export error:",e),yield this.showErrorAlert("Export Failed","There was an error exporting your notes. Please try again.")}})}triggerImport(){this.fileInput?.nativeElement&&this.fileInput.nativeElement.click()}handleFileImport(e){return m(this,null,function*(){let t=e.target,n=t.files?.[0];if(n){t.value="";try{let c=yield n.text(),p=JSON.parse(c);if(!this.validateImportData(p)){yield this.showErrorAlert("Invalid File","The selected file is not a valid SmartNotes backup file.");return}let d=p.notes||p,u=this.notesStore.notes().length;u>0?yield(yield this.alertController.create({header:"Import Notes",message:`You currently have ${u} note${u!==1?"s":""}. The import file contains ${d.length} note${d.length!==1?"s":""}. How would you like to proceed?`,buttons:[{text:"Cancel",role:"cancel"},{text:"Replace All",handler:()=>{this.importNotes(d,!1)}},{text:"Merge",handler:()=>{this.importNotes(d,!0)}}]})).present():this.importNotes(d,!1)}catch(c){console.error("Import error:",c),yield this.showErrorAlert("Import Failed","There was an error reading the file. Please make sure it is a valid JSON file.")}}})}validateImportData(e){return Array.isArray(e)?e.every(t=>this.isValidNote(t)):e&&typeof e=="object"&&Array.isArray(e.notes)?e.notes.every(t=>this.isValidNote(t)):!1}isValidNote(e){return e&&typeof e=="object"&&typeof e.id=="string"&&typeof e.title=="string"&&typeof e.body=="string"&&typeof e.createdAt=="number"&&["Recording","Upload","Typed"].includes(e.source)}importNotes(e,t){try{this.notesStore.importNotes(e,t);let n=this.notesStore.notes().length;this.showSuccessAlert("Import Successful",`Successfully imported ${e.length} note${e.length!==1?"s":""}. You now have ${n} note${n!==1?"s":""} in total.`)}catch(n){console.error("Import error:",n),this.showErrorAlert("Import Failed","There was an error importing the notes. Please try again.")}}showSuccessAlert(e,t){return m(this,null,function*(){yield(yield this.alertController.create({header:e,message:t,buttons:["OK"]})).present()})}showErrorAlert(e,t){return m(this,null,function*(){yield(yield this.alertController.create({header:e,message:t,buttons:["OK"]})).present()})}calculateCacheSize(){return m(this,null,function*(){this.isCalculatingCache.set(!0);try{let e=0;if("caches"in self){let t=yield caches.keys();for(let n of t){let c=yield caches.open(n),p=yield c.keys();for(let d of p){let u=yield c.match(d);if(u){let S=yield u.blob();e+=S.size}}}}this.cacheSize.set(this.formatBytes(e))}catch(e){console.error("Error calculating cache size:",e),this.cacheSize.set("Unknown")}finally{this.isCalculatingCache.set(!1)}})}formatBytes(e){if(e===0)return"0 MB";let t=1024,n=["Bytes","KB","MB","GB"],c=Math.floor(Math.log(e)/Math.log(t));return Math.round(e/Math.pow(t,c)*100)/100+" "+n[c]}clearCache(){return m(this,null,function*(){yield(yield this.alertController.create({header:"Clear Model Cache",message:`This will delete all cached models (${this.cacheSize()}). You will need to download them again when you transcribe. Continue?`,buttons:[{text:"Cancel",role:"cancel"},{text:"Clear Cache",role:"destructive",handler:()=>m(this,null,function*(){yield this.performCacheClear()})}]})).present()})}performCacheClear(){return m(this,null,function*(){try{if("caches"in self){let e=yield caches.keys();for(let t of e)yield caches.delete(t)}this.settings.setLastUsedModel(null),yield this.calculateCacheSize(),yield this.showSuccessAlert("Cache Cleared","All cached models have been deleted successfully.")}catch(e){console.error("Error clearing cache:",e),yield this.showErrorAlert("Clear Failed","There was an error clearing the cache. Please try again.")}})}};s.\u0275fac=function(t){return new(t||s)},s.\u0275cmp=L({type:s,selectors:[["app-settings"]],viewQuery:function(t,n){if(t&1&&$(be,5),t&2){let c;F(c=B())&&(n.fileInput=c.first)}},decls:76,vars:9,consts:[["fileInput",""],[3,"translucent"],[1,"settings-content"],[1,"content-wrapper"],[1,"glass-card"],["lines","full"],["position","stacked"],["interface","popover",3,"ionChange","value","disabled"],[3,"value"],[1,"toggles-row"],[1,"model-info"],["lines","none"],[2,"color","#2ed573"],[2,"color","#ff4c67"],["expand","block","fill","outline","color","danger",1,"clear-button",3,"click","disabled"],["slot","start","name","trash-outline"],[1,"data-description"],[1,"data-actions"],["expand","block","fill","outline",1,"data-button",3,"click"],["slot","start","name","download-outline"],["slot","start","name","cloud-upload-outline"],["type","file","accept",".json",2,"display","none",3,"change"],[1,"donation-description"],["expand","block",1,"donation-button",3,"click"],["slot","start","name","heart-outline"],[1,"toggle-item"],[3,"ionChange","checked","disabled"],[1,"model-name"],[1,"model-hint"],["interface","popover",3,"ionChange","value"],["value","transcribe"],["value","translate"]],template:function(t,n){if(t&1){let c=P();o(0,"ion-header",1)(1,"ion-toolbar")(2,"ion-title"),r(3,"Settings"),a()()(),o(4,"ion-content",2)(5,"div",3)(6,"ion-card",4)(7,"ion-card-header")(8,"ion-card-subtitle"),r(9,"Model"),a(),o(10,"ion-card-title"),r(11,"Transcription Engine"),a()(),o(12,"ion-card-content")(13,"ion-item",5)(14,"ion-label",6),r(15,"Select the model to use"),a(),o(16,"ion-select",7),w("ionChange",function(d){return h(c),f(n.onModelChange(d.detail.value))}),I(17,ve,2,2,"ion-select-option",8,ye),a()(),y(19,Ee,5,2,"div",9),o(20,"div",10)(21,"ion-item",11)(22,"ion-label")(23,"h3"),r(24,"Active Model"),a(),y(25,Pe,4,1)(26,ke,4,1),a()()()()(),y(27,Te,21,2,"ion-card",4),o(28,"ion-card",4)(29,"ion-card-header")(30,"ion-card-subtitle"),r(31,"Network Status"),a(),o(32,"ion-card-title"),y(33,Ie,2,0,"span",12)(34,Ne,2,0,"span",13),a()(),o(35,"ion-card-content")(36,"ion-item",11)(37,"ion-label")(38,"h3"),r(39,"Model Cache"),a(),o(40,"p"),y(41,De,2,0,"span")(42,Ue,2,1,"span"),a()()(),o(43,"ion-button",14),w("click",function(){return h(c),f(n.clearCache())}),E(44,"ion-icon",15),r(45," Clear Model Cache "),a()()(),o(46,"ion-card",4)(47,"ion-card-header")(48,"ion-card-subtitle"),r(49,"Data Management"),a(),o(50,"ion-card-title"),r(51,"Export & Import Notes"),a()(),o(52,"ion-card-content")(53,"p",16),r(54," Export your notes as a JSON file for backup, or import notes from a previous export. "),a(),o(55,"div",17)(56,"ion-button",18),w("click",function(){return h(c),f(n.exportNotes())}),E(57,"ion-icon",19),r(58," Export Notes "),a(),o(59,"ion-button",18),w("click",function(){return h(c),f(n.triggerImport())}),E(60,"ion-icon",20),r(61," Import Notes "),a()(),o(62,"input",21,0),w("change",function(d){return h(c),f(n.handleFileImport(d))}),a()()(),o(64,"ion-card",4)(65,"ion-card-header")(66,"ion-card-subtitle"),r(67,"Support"),a(),o(68,"ion-card-title"),r(69,"Support Development"),a()(),o(70,"ion-card-content")(71,"p",22),r(72," If you find this app useful, consider making a donation to support continued development and improvements. "),a(),o(73,"ion-button",23),w("click",function(){return h(c),f(n.openDonationLink())}),E(74,"ion-icon",24),r(75," Donate "),a()()()()()}t&2&&(x("translucent",!0),g(16),x("value",n.model())("disabled",!n.networkService.isOnline()),g(),N(n.modelOptions),g(2),M(n.isMultilingualModel()?19:-1),g(6),M(n.lastUsedModel()?25:26),g(2),M(n.multilingual()?27:-1),g(6),M(n.networkService.isOnline()?33:34),g(8),M(n.isCalculatingCache()?41:42),g(2),x("disabled",n.isCalculatingCache()||n.cacheSize()==="0 MB"))},dependencies:[J,te,ee,H,W,q,Q,K,Y,G,Z,oe,X,ae,j,ie],styles:[".settings-content[_ngcontent-%COMP%]{--background: linear-gradient(180deg, #181818 0%, #0d0d0d 65%, #050505 100%);--padding-start: clamp(1rem, 3vw, 2.5rem);--padding-end: clamp(.5rem, 2vw, 1rem);--padding-top: 1.25rem;--padding-bottom: 1.25rem}.content-wrapper[_ngcontent-%COMP%]{max-width:800px;margin:0 auto;display:flex;flex-direction:column;gap:1rem;padding-right:0}.glass-card[_ngcontent-%COMP%]{background:#1f1f1f;border:1px solid #2a2a2a;border-radius:20px;box-shadow:0 20px 40px #00000073}.glass-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]{padding-left:0;padding-bottom:0}ion-item[_ngcontent-%COMP%]{--background: transparent;--border-color: rgba(255, 255, 255, .12)}ion-select[_ngcontent-%COMP%]{--placeholder-color: rgba(255, 255, 255, .6);color:#fff}ion-card-header[_ngcontent-%COMP%]{padding-left:13px!important;padding-bottom:0}.clear-button[_ngcontent-%COMP%]{padding-left:13px;padding-bottom:16px}.toggles-row[_ngcontent-%COMP%]{display:flex;flex-direction:row;margin-top:.75rem;margin-left:16px;margin-bottom:16px}.toggle-item[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;margin-right:15px;flex:1}.toggle-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin-right:10px}.toggle-item[_ngcontent-%COMP%]   ion-toggle[_ngcontent-%COMP%]{width:36px;height:20px;--handle-width: 15px;--handle-height: 15px;margin-top:3px}ion-item[_ngcontent-%COMP%]{font-size:13px!important}ion-label[_ngcontent-%COMP%]{font-size:15px!important}.model-info[_ngcontent-%COMP%]{margin-top:1rem;padding:0 16px 16px}.model-info[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--background: rgba(10, 132, 255, .1);border-radius:12px;border:1px solid rgba(10,132,255,.2)}.model-info[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:14px;font-weight:600;color:#ffffffb3;margin:0 0 8px;text-transform:uppercase;letter-spacing:.5px}.model-name[_ngcontent-%COMP%]{font-size:16px;font-weight:600;color:#fff;margin:8px 0;font-family:Courier New,monospace;word-break:break-all}.quantized-label[_ngcontent-%COMP%]{color:#fff9;font-weight:400;font-size:14px}.model-hint[_ngcontent-%COMP%]{font-size:12px;color:#ffffff80;margin-top:4px;font-style:italic}.donation-description[_ngcontent-%COMP%], .data-description[_ngcontent-%COMP%]{color:#fffc;font-size:.9rem;line-height:1.5;margin-bottom:1.5rem;padding:0 16px}.data-actions[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem;padding:0 16px 16px}.data-button[_ngcontent-%COMP%]{--border-color: rgba(255, 255, 255, .2);--color: #ffffff;--background: transparent;font-weight:500;margin:0}.data-button[_ngcontent-%COMP%]:hover{--border-color: #0a84ff;--background: rgba(10, 132, 255, .1)}.donation-button[_ngcontent-%COMP%]{--background: #0a84ff;--color: #ffffff;font-weight:600;margin:0 16px 16px}"]});let i=s;return i})();export{ct as SettingsPage};
